<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>üé∞ TragaBitcoins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="/socket.io/socket.io.js"></script>
    <style>
      body {
        background: radial-gradient(circle at center, #222, #000);
        color: #fff;
        font-family: "Poppins", sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      h1 {
        margin-top: 20px;
        font-size: 2.5em;
        color: gold;
      }
      #login {
        margin-top: 50px;
      }
      input,
      button {
        padding: 10px;
        border: none;
        border-radius: 6px;
        margin: 5px;
        font-size: 1em;
      }
      input {
        width: 200px;
      }
      button {
        background-color: gold;
        color: #000;
        font-weight: bold;
        cursor: pointer;
      }
      #slot {
        font-size: 5em;
        margin: 30px;
      }
      #balance {
        font-size: 1.2em;
        margin: 10px;
      }
      #invoiceBox {
        background: #111;
        border: 2px solid gold;
        padding: 10px;
        margin: 15px auto;
        width: 80%;
        display: none;
        border-radius: 8px;
      }
      #invoiceBox code {
        font-family: monospace;
        color: lime;
      }
    </style>
  </head>
  <body>
    <h1>üé∞ TragaBitcoins</h1>

    <div id="login">
      <input id="username" placeholder="Tu nombre..." />
      <button id="loginBtn">Entrar</button>
    </div>

    <div id="game" style="display: none">
      <p id="userDisplay"></p>
      <p id="balance">Saldo: 0 sats</p>

      <div>
        <input id="depositAmount" type="number" placeholder="Monto (sats)" />
        <button id="depositBtn">Depositar ‚ö°</button>
      </div>

      <div id="invoiceBox">
        <p>Factura LN:</p>
        <code id="invoice"></code>
        <p>Escanea con tu billetera ‚ö°</p>
        <button id="simulateBtn">Simular Pago</button>
      </div>

      <div id="slot">üçí üçã üçä</div>
      <button id="spinBtn">Girar üé∞</button>
      <p id="result"></p>
    </div>

    <script>
      const socket = io();
      const loginDiv = document.getElementById("login");
      const gameDiv = document.getElementById("game");
      const userDisplay = document.getElementById("userDisplay");
      const balanceDisplay = document.getElementById("balance");
      const invoiceBox = document.getElementById("invoiceBox");
      const invoiceText = document.getElementById("invoice");
      const result = document.getElementById("result");

      document.getElementById("loginBtn").onclick = () => {
        const username = document.getElementById("username").value.trim();
        socket.emit("login", username);
      };

      socket.on("loginSuccess", (data) => {
        loginDiv.style.display = "none";
        gameDiv.style.display = "block";
        userDisplay.innerText = `Jugador: ${data.username}`;
        balanceDisplay.innerText = `Saldo: ${data.balance} sats`;
      });

      socket.on("loginError", (msg) => alert(msg));

      // --- DEPOSIT ---
      document.getElementById("depositBtn").onclick = () => {
        const amount = parseInt(document.getElementById("depositAmount").value);
        socket.emit("requestDeposit", amount);
      };

      socket.on("depositInvoice", (invoice) => {
        invoiceBox.style.display = "block";
        invoiceText.innerText = invoice;
      });

      socket.on("depositError", (msg) => alert(msg));

      document.getElementById("simulateBtn").onclick = () => {
        const amount = parseInt(document.getElementById("depositAmount").value);
        socket.emit("simulatePayment", amount);
        invoiceBox.style.display = "none";
      };

      socket.on("balanceUpdate", (newBalance) => {
        balanceDisplay.innerText = `Saldo: ${newBalance} sats`;
      });

      // --- SPIN ---
      document.getElementById("spinBtn").onclick = () => {
        socket.emit("spin");
      };

      socket.on("spinResult", (data) => {
        document.getElementById("slot").innerText = data.result.join(" ");
        result.innerText =
          data.win > 0
            ? `üéâ Ganaste ${data.win} sats!`
            : "üò¢ Sin premio...";
        balanceDisplay.innerText = `Saldo: ${data.balance} sats`;
      });

      socket.on("spinError", (msg) => alert(msg));
    </script>
  </body>
</html>
